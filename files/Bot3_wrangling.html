<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Susi Zajitschek" />

<meta name="date" content="2025-05-08" />

<title>Bot3 wrangling</title>

<script src="Bot3_wrangling_files/header-attrs-2.29/header-attrs.js"></script>
<script src="Bot3_wrangling_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Bot3_wrangling_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Bot3_wrangling_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Bot3_wrangling_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Bot3_wrangling_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="Bot3_wrangling_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="Bot3_wrangling_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="Bot3_wrangling_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="Bot3_wrangling_files/navigation-1.1/tabsets.js"></script>
<link href="Bot3_wrangling_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Bot3_wrangling_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">Bot3 wrangling</h1>
<h4 class="author">Susi Zajitschek</h4>
<h4 class="date">2025-05-08</h4>

</div>


<div id="download" class="section level2">
<h2>Download</h2>
<p>Click here:</p>
<p><a download="Bot3_wrangling.Rmd" href="Bot3_wrangling.Rmd">Download
Rmd Code</a></p>
<p>Download and save file, and open in R Studio (doesn’t matter if it
shows file extension html or rmd, if will be executable as markdown)</p>
<pre class="r"><code>library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
</div>
<div id="making-a-new-variable" class="section level2">
<h2>1. Making a new variable</h2>
<p>Why? You may need to add a new category, or transform variables that
you would like to analyse, a new variable that is a function of existing
ones, or a new set of labels</p>
<p>Let’s try to make a ratio, for example Sepal by Petal Length</p>
<pre class="r"><code>newIris &lt;- iris %&gt;% 
  mutate(ratio_SL_PL = Sepal.Length/Petal.Length)</code></pre>
<p>and calculate petal leaf area, which we add directly to the new
dataframe:</p>
<pre class="r"><code>newIris &lt;- newIris %&gt;%
  mutate(Petal.Area = Petal.Length * Petal.Width)</code></pre>
<div id="renaming-your-variables" class="section level3">
<h3>Renaming your variable/s</h3>
<pre class="r"><code>newIris  &lt;- rename(newIris,  Ratio = ratio_SL_PL)</code></pre>
<p>NEW name first, then = old name</p>
</div>
</div>
<div id="a.-making-2-variables-into-one" class="section level2">
<h2>1a. Making 2 variables into one</h2>
<p>use “unite” to combine parts of your data (i.e. if you have split
colums you’d like to combine: for example: Habitat and season,
year/month/day as one date column), example:</p>
<p>df &lt;- unite(df, “nameNEWvariable”, c(variable1, variable2), sep =
“_“)</p>
<div id="adding-a-condition-into-this" class="section level3">
<h3>Adding a condition into this</h3>
<p>Back to iris data: I want to group the species based on having short
or long petals (which here is me arbitrarily defining long = &gt;5 and
short anything below 5)</p>
<pre class="r"><code>newIris &lt;- newIris %&gt;%
  mutate(
    Species_PetalLength = paste(Species, ifelse(Petal.Length &gt; 5, &quot;LongPetal&quot;, &quot;ShortPetal&quot;), sep = &quot;_&quot;)
  )</code></pre>
</div>
</div>
<div id="b.-separating-a-long-variable-into-2-separate-ones"
class="section level2">
<h2>1b. Separating a long variable into 2 separate ones:</h2>
<p>May be usieful of you have genus &amp; species names combined in a
colum and would like to separate them:</p>
<p>df &lt;- separate(df, combinedVar, c(“Genus”, “species”), sep = “_“,
remove = FALSE)</p>
<pre class="r"><code>library(tidyr)

newIris &lt;- separate(newIris, Species_PetalLength, c(&quot;SpeciesNew&quot;, &quot;PL_new&quot;), sep = &quot;_&quot;, remove = FALSE)</code></pre>
</div>
<div id="subsetting-rows" class="section level1">
<h1>2. Subsetting rows</h1>
<p>Based on certain criteria, you can “filter” your dataset. Common
logical operators that you can use</p>
<p>&lt; less than &gt; greater than == equal to &lt;= less than or equal
to &gt;= greater than or equal to != not equal to in.NA = is NA !is.na =
is not NA</p>
<pre class="r"><code>?Comparison</code></pre>
<pre><code>## starting httpd help server ... done</code></pre>
<p>We can also sample random subsets of your dataframe (for example if
your dataframe is massibe and you’d like to explora a small random
subset first, or you you’re after resampling for bootstrapping)</p>
<p>Here we sample 100 random rows from the iris dataset, creating a new
df (the number of samples needs to be smaller than the samplescontained
in your df!):</p>
<pre class="r"><code>iris.100 &lt;- sample_n(newIris, 100, replace = FALSE)</code></pre>
<p>Or you select the higest value (say top 3 in Petal.Area)</p>
<pre class="r"><code>iris.top &lt;- top_n(newIris, 3, Petal.Area)</code></pre>
<div id="a-removing-duplicate-rows" class="section level2">
<h2>2a Removing duplicate rows</h2>
<p>df.distinct &lt;- distinct(df)</p>
<pre class="r"><code>iris.distinct &lt;- distinct(newIris)</code></pre>
</div>
<div id="b-selecting-colums-by-name" class="section level2">
<h2>2b Selecting colums (by name)</h2>
<pre class="r"><code>IrisReduced &lt;- select(newIris, Species, Petal.Area, PL_new)</code></pre>
<p>There’s a lot we can select,see ?select</p>
<p>for example we want a df that only contains information on something
that is specified in the names of the columns, using Petals and sepals
here:</p>
<pre class="r"><code>IrisPetalOnly &lt;- select(newIris, contains(&quot;Petal&quot;))
IrisSepalOnly &lt;- select(newIris, contains(&quot;Sepal&quot;))</code></pre>
</div>
</div>
<div id="summarising-data" class="section level1">
<h1>3. Summarising data</h1>
<p>The dataset is clean and manageable now, so we can start exploring.
For example we’d like to know how large “large” compared to “short”
petals are:</p>
<pre class="r"><code>newIris %&gt;% 
  filter(PL_new == &quot;ShortPetal&quot;) %&gt;%
  summarise(Mean.PL = mean(Petal.Length))</code></pre>
<pre><code>##    Mean.PL
## 1 3.007407</code></pre>
<p>this would require a separate operation for the LongPetal, OR: use
group_by:</p>
<pre class="r"><code> newIris %&gt;%
  group_by(PL_new) %&gt;%
  summarise(Mean.PL = mean(Petal.Length, na.rm = TRUE))</code></pre>
<pre><code>## # A tibble: 2 × 2
##   PL_new     Mean.PL
##   &lt;chr&gt;        &lt;dbl&gt;
## 1 LongPetal     5.69
## 2 ShortPetal    3.01</code></pre>
<p>of course we can do much more than getting means, such as max, min,
med, sd, se, IQR, n, …</p>
<p>This links to the ggplot 2 workshop - especially if we’d like to lot
values such as means and SEs.</p>
<pre class="r"><code># summary stats required for barchart

iris.barplot &lt;- iris %&gt;% 
    group_by(Species) %&gt;% 
  summarise(meanPetal.Length = mean(Petal.Length), SEPetal.Length =
  sd(Petal.Length)/sqrt(length(Petal.Length)), lowerErr =(meanPetal.Length -
SEPetal.Length), upperErr = (meanPetal.Length + SEPetal.Length))

iris.barplot</code></pre>
<pre><code>## # A tibble: 3 × 5
##   Species    meanPetal.Length SEPetal.Length lowerErr upperErr
##   &lt;fct&gt;                 &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 setosa                 1.46         0.0246     1.44     1.49
## 2 versicolor             4.26         0.0665     4.19     4.33
## 3 virginica              5.55         0.0780     5.47     5.63</code></pre>
<pre class="r"><code>library(ggplot2)

ggplot(iris.barplot, aes(x = Species, y = meanPetal.Length)) + geom_col(width
= 0.5) + geom_errorbar(aes(ymin = lowerErr, ymax = upperErr), width = 0.1) +
theme_bw()</code></pre>
<p><img src="Bot3_wrangling_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="combining-datasets" class="section level1">
<h1>4. Combining datasets</h1>
<p>You may have measured and recorded different things on the same
specimen - they’re now in different datasets, but there’s a “unifying”
variable (such as ID number).</p>
<p>Let’s stay with our iris dataset and split it in two, so that we have
something to combine! ;-)</p>
<pre class="r"><code>setosa &lt;- subset(iris, Species == &quot;setosa&quot;) 
other &lt;- subset(iris, Species != &quot;setosa&quot;)

# Add a common identifier 
setosa$ID &lt;- 1:nrow(setosa)
other$ID &lt;- 1:nrow(other)</code></pre>
<p>There are many different ways to combine.</p>
<p>Base R: rbind()<br />
Caveat: the order of the columns must match!! It does here so let’s
try</p>
<pre class="r"><code>combined_rbind &lt;- rbind(setosa, other)</code></pre>
<p>dplyr: bind_rows (order of columns doesn’t strictly matter):</p>
<pre class="r"><code>combined_bind_rows &lt;- bind_rows(setosa, other)</code></pre>
<p>If we’ve created summary stats and would like to merge them back into
our original dataset, let’s create a new Sepal length mean value</p>
<pre class="r"><code> meanSL &lt;- newIris %&gt;%
  group_by(Species) %&gt;%
  summarise(Mean.SL = mean(Sepal.Length, na.rm = TRUE))</code></pre>
<p>now let’s merge the new mean</p>
<pre class="r"><code>merged_iris &lt;- merge(iris, meanSL, by = &quot;Species&quot;)
head(merged_iris)</code></pre>
<pre><code>##   Species Sepal.Length Sepal.Width Petal.Length Petal.Width Mean.SL
## 1  setosa          5.1         3.5          1.4         0.2   5.006
## 2  setosa          4.9         3.0          1.4         0.2   5.006
## 3  setosa          4.7         3.2          1.3         0.2   5.006
## 4  setosa          4.6         3.1          1.5         0.2   5.006
## 5  setosa          5.0         3.6          1.4         0.2   5.006
## 6  setosa          5.4         3.9          1.7         0.4   5.006</code></pre>
<p>This was actually bas R - we can do this with dplyr, too.</p>
<p>For this we’re using “left-join”. This function keeps all rows from
the “first” dataframe, and preserves their order. This is particularly
useful if you have one “main” dataframe that you’d like to add addional
variables to.</p>
<pre class="r"><code>merged_dplyr &lt;- iris %&gt;%
  left_join(meanSL, by = &quot;Species&quot;)</code></pre>
<p><em>Note</em>: For particularly messy data (i.e. many of the IDs not
overlapping in both datasets), you can look into</p>
<p>inner_join() this will drop all data where the identifier is not
present in both datasets</p>
<p>right_join() like left join, but preserve the second dataframe</p>
<p>full_join() you guessed it - this preserves all data</p>
</div>
<div id="reshaping" class="section level1">
<h1>5. Reshaping</h1>
<p>For some visualisations we may need the change the format of the
dataframe.</p>
<p>As we’re sticking with the iris dataset, let’s create a “long” format
from the original one, after adding and ID in</p>
<pre class="r"><code>irisID  &lt;- iris %&gt;%
  mutate(Flower_ID = 1:n())  # adding an ID


iris_long &lt;- irisID %&gt;%
  pivot_longer(
    cols = -c(&quot;Species&quot;, &quot;Flower_ID&quot;),  # Columns to pivot (all except Species and Flower ID)
    names_to = &quot;Measurement&quot;, # Name of the new column for measurement type
    values_to = &quot;Value&quot;  #Name of the new column for the measurement value
  )</code></pre>
<p>lib what could that be useful for?</p>
<pre class="r"><code>ggplot(iris_long, aes(x = Measurement, y = Value, fill = Species)) +
  geom_violin() +
  labs(title = &quot;Measurement Type and Species&quot;,
       x = &quot;Measurement Type&quot;,
       y = &quot;Value (cm)&quot;,
       fill = &quot;Species&quot;) +
  theme_minimal()</code></pre>
<p><img src="Bot3_wrangling_files/figure-html/unnamed-chunk-23-1.png" width="672" />
The plot combines ALL measurements and shows species by colour; a
similar visualisation in the original “iris” dataset would require 3
different plots.</p>
<p>… and finally, let’s practice to get from a long to a wide
format:</p>
<pre class="r"><code>iris_wide &lt;- iris_long %&gt;%
  pivot_wider(
    id_cols = c(Species, Flower_ID),          # Columns that will remain as identifiers
    names_from = Measurement,    # Column whose unique values will become new column names
    values_from = Value         # Column whose values will populate the new columns
  )</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
